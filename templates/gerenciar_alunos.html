{% extends "base.html" %}
{% block title %}Gerenciar Alunos{% endblock %}
{% block content %}
<div class="card">
    <h1>Gerenciamento de Alunos</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="flash-message {{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <h2 style="font-weight: 400; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; margin-top: 30px;">Alunos Cadastrados</h2>
    <table>
        <thead>
            <tr>
                <th>Nome</th>
                <th>Idade</th>
                <th>Curso</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for aluno in alunos %}
            <tr>
                <td>{{ aluno.nome }}</td>
                <td>{{ aluno.idade }}</td>
                <td>{{ aluno.curso }}</td>
                <td class="actions-cell">
                    <a href="{{ url_for('editar_aluno', nome_do_aluno=aluno.nome) }}" class="action-btn edit-btn">Editar</a>
                    <a href="{{ url_for('deletar_aluno', nome_do_aluno=aluno.nome) }}" 
                       class="action-btn delete-btn" 
                       onclick="return confirm('Tem certeza que deseja deletar este aluno e sua conta de login? Esta ação não pode ser desfeita.');">
                       Deletar
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2 style="font-weight: 400; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; margin-top: 50px;">Cadastrar Novo Aluno</h2>
    <form method="post" action="{{ url_for('gerenciar_alunos') }}" style="margin-top: 20px;">
        <div class="form-group">
            <label for="nome">Nome Completo (será o username):</label>
            <input type="text" id="nome" name="nome" required>
        </div>
        <div class="form-group">
            <label for="idade">Idade:</label>
            <input type="number" id="idade" name="idade" required min="1">
        </div>
        <div class="form-group">
            <label for="curso">Curso:</label>
            <select id="curso" name="curso">
                <option value="Lógica de Programação">Lógica de Programação</option>
                <option value="Linguagens de Programação">Linguagens de Programação</option>
                <option value="Algorítimos e Estruturas de dados">Algorítimos e Estruturas de dados</option>
            </select>
        </div>
         <div class="form-group">
            <label for="horas_estudo">Média de Horas de Estudo (por dia):</label>
            <input type="number" step="0.5" id="horas_estudo" name="horas_estudo" required min="0">
        </div>
        <hr style="border: 0; border-top: 1px solid var(--border-color); margin: 10px 0;">
        <div class="form-group">
            <label for="criar_login" style="flex-direction: row; align-items: center; gap: 10px;">
                <input type="checkbox" id="criar_login" name="criar_login" style="width: auto;" onchange="toggleLoginFields()">
                Criar conta de login para este aluno
            </label>
        </div>
        <div id="login-fields" style="display: none; gap: 20px;">
            <div class="form-group">
                <label for="password">Senha:</label>
                <input type="password" id="password" name="password">
            </div>
            <div class="form-group">
                <label for="role">Permissão (Função):</label>
                <select id="role" name="role">
                    <option value="viewer">Visitante</option>
                    <option value="admin">Administrador</option>
                </select>
            </div>
        </div>
        <button type="submit">Adicionar Aluno</button>
    </form>
</div>
<script>
    function toggleLoginFields() {
        const checkbox = document.getElementById('criar_login');
        const loginFields = document.getElementById('login-fields');
        const passwordField = document.getElementById('password');
        if (checkbox.checked) {
            loginFields.style.display = 'grid';
            passwordField.required = true;
        } else {
            loginFields.style.display = 'none';
            passwordField.required = false;
        }
    }
</script>
{% endblock %}