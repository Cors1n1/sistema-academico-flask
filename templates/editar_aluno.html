{% extends "base.html" %}
{% block title %}Editar Aluno{% endblock %}
{% block content %}
<div class="card">
    <h1>Editar Aluno: {{ aluno.nome }}</h1>
    <form method="post">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="form-group">
            <label>Nome do Aluno (não pode ser alterado)</label>
            <input type="text" value="{{ aluno.nome }}" readonly disabled>
        </div>
        <div class="form-group">
            <label for="nascimento">Data de Nascimento:</label>
            <input type="date" id="nascimento" name="nascimento" required value="{{ aluno.nascimento }}">
        </div>
        <div class="form-group">
            <label for="email">E-mail:</label>
            <input type="email" id="email" name="email" value="{{ aluno.email if aluno.email }}">
        </div>
        <div class="form-group">
            <label for="celular">Número de Celular:</label>
            <input type="tel" id="celular" name="celular" placeholder="(XX) XXXXX-XXXX" value="{{ aluno.celular if aluno.celular }}">
        </div>
        <div class="form-group">
            <label for="cep">CEP:</label>
            <input type="text" id="cep" name="cep" required value="{{ aluno.cep if aluno.cep }}">
        </div>
        <div class="form-group">
            <label for="rua">Endereço (Rua):</label>
            <input type="text" id="rua" name="rua" value="{{ aluno.rua if aluno.rua }}" readonly>
        </div>
        <div class="form-group">
            <label for="bairro">Bairro:</label>
            <input type="text" id="bairro" name="bairro" value="{{ aluno.bairro if aluno.bairro }}" readonly>
        </div>
        <div class="form-group">
            <label for="cidade">Cidade:</label>
            <input type="text" id="cidade" name="cidade" value="{{ aluno.cidade if aluno.cidade }}" readonly>
        </div>
        <div class="form-group">
            <label for="numero">Número:</label>
            <input type="text" id="numero" name="numero" required value="{{ aluno.numero if aluno.numero }}">
        </div>
        <div class="form-group">
            <label for="complemento">Complemento:</label>
            <input type="text" id="complemento" name="complemento" value="{{ aluno.complemento if aluno.complemento }}">
        </div>
        <div class="form-group">
            <label for="curso">Curso(s):</label>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" name="curso" value="Lógica de Programação" {% if 'Lógica de Programação' in aluno.curso %}checked{% endif %}> Lógica de Programação
                </label>
                <label>
                    <input type="checkbox" name="curso" value="Linguagens de Programação" {% if 'Linguagens de Programação' in aluno.curso %}checked{% endif %}> Linguagens de Programação
                </label>
                <label>
                    <input type="checkbox" name="curso" value="Algorítimos e Estruturas de dados" {% if 'Algorítimos e Estruturas de dados' in aluno.curso %}checked{% endif %}> Algorítimos e Estruturas de dados
                </label>
            </div>
        </div>
         <div class="form-group">
            <label for="horas_estudo">Média de Horas de Estudo:</label>
            <input type="number" step="0.5" id="horas_estudo" name="horas_estudo" required value="{{ aluno.horas_estudo }}">
        </div>

        {% if usuario %}
        <hr style="border: 0; border-top: 1px solid var(--border-color); margin: 10px 0;">
        <h2 style="font-size: 1.5em; font-weight: 400;">Configurações de Acesso</h2>
        <div class="form-group">
            <label for="role">Permissão (Função):</label>
            <select id="role" name="role">
                <option value="aluno" {% if usuario.role == 'aluno' %}selected{% endif %}>Aluno</option>
                <option value="professor" {% if usuario.role == 'professor' %}selected{% endif %}>Professor</option>
                <option value="admin" {% if usuario.role == 'admin' %}selected{% endif %}>Administrador</option>
            </select>
        </div>
        <div class="form-group">
            <label for="nova_senha">Nova Senha (opcional):</label>
            <input type="password" id="nova_senha" name="nova_senha">
        </div>
        <div class="form-group">
            <label for="confirmar_nova_senha">Confirmar Nova Senha:</label>
            <input type="password" id="confirmar_nova_senha" name="confirmar_nova_senha">
        </div>
        {% endif %}
        
        <div class="form-actions">
            <button type="submit">Salvar Alterações</button>
            <a href="{{ url_for('gerenciar_alunos') }}" class="cancel-btn">Cancelar</a>
        </div>
    </form>
</div>
<script>
    // Lógica para preenchimento automático do CEP
    document.getElementById('cep').addEventListener('blur', function() {
        const cep = this.value.replace(/\D/g, '');
        if (cep.length === 8) {
            fetch(`https://viacep.com.br/ws/${cep}/json/`)
                .then(response => response.json())
                .then(data => {
                    if (!data.erro) {
                        document.getElementById('rua').value = data.logradouro;
                        document.getElementById('bairro').value = data.bairro;
                        document.getElementById('cidade').value = data.localidade;
                    } else {
                        alert('CEP não encontrado.');
                    }
                })
                .catch(error => {
                    console.error('Erro ao buscar o CEP:', error);
                    alert('Erro ao buscar o CEP. Tente novamente.');
                });
        }
    });
</script>
{% endblock %}