{% extends "base.html" %}

{% block title %}Hub Principal - Sistema Acadêmico{% endblock %}

{% block content %}
<div class="hub-hero" id="hub-hero">
    {% if session.get('role') == 'admin' %}
        <h1>Painel de Gerenciamento e Ensino</h1>
        <p>Como administrador, sua função é gerenciar e organizar o conteúdo para a turma. Comece por aqui para administrar o sistema.</p>
    {% elif session.get('role') == 'professor' %}
        <h1>Painel de Ensino</h1>
        <p>Como professor, sua função é gerenciar e organizar o conteúdo para a turma. Comece por aqui para administrar o sistema.</p>
    {% else %}
        <h1>Bem-vindo ao Sistema Acadêmico</h1>
        <p>Pronto para aprender? Aqui você pode acessar suas aulas, exercícios e provas. Escolha uma opção para começar sua jornada.</p>
    {% endif %}
</div>

<div class="action-grid-header">
    <button id="reset-order-btn" class="action-btn cancel-btn">Resetar Ordem</button>
</div>
<div class="action-grid" id="action-grid">
    {% for card in cards %}
    <a href="{{ card.url }}" class="action-card" data-card="{{ card.id }}">
        <i class="{{ card.icon }}"></i>
        <h2>{{ card.title }}</h2>
        <p>{{ card.desc }}</p>
    </a>
    {% endfor %}
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const grid = document.getElementById('action-grid');
        const resetButton = document.getElementById('reset-order-btn');

        // Inicializa a biblioteca Sortable.js
        new Sortable(grid, {
            animation: 150,
            ghostClass: 'ghost-item',
            onEnd: function (evt) {
                const newOrder = Array.from(grid.children).map(card => card.dataset.card);
                
                // Envia a nova ordem para o servidor via fetch
                fetch('{{ url_for("save_card_order") }}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ order: newOrder }),
                });
            },
        });

        // Adiciona o evento de clique para o botão de reset
        if (resetButton) {
            resetButton.addEventListener('click', function() {
                // Envia uma requisição para a nova rota de reset no Flask
                fetch('{{ url_for("reset_card_order") }}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                }).then(response => {
                    if (response.ok) {
                        window.location.reload(); // Recarrega a página para aplicar a ordem padrão
                    }
                });
            });
        }
    });
</script>
{% endblock %}