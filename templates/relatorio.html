{% extends "base.html" %}

{% block title %}Relatório - Sistema de Alunos{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
        <h1>Relatório da Plataforma</h1>
        <div class="export-buttons">
            <a href="{{ url_for('exportar', formato='pdf') }}" class="action-btn export-btn">
                <i class="fas fa-file-pdf" style="margin-right: 8px;"></i>Exportar PDF
            </a>
            <a href="{{ url_for('exportar', formato='excel') }}" class="action-btn export-btn">
                <i class="fas fa-file-excel" style="margin-right: 8px;"></i>Exportar Excel
            </a>
        </div>
    </div>
    {% if dados %}
    <div class="report-grid">
        <div class="stat-card">
            <div class="stat-icon total"><i class="fas fa-users"></i></div>
            <div class="stat-info">
                <div class="value count-up" data-target="{{ dados.total_alunos }}">0</div>
                <div class="label">Total de Alunos Cadastrados</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon age"><i class="fas fa-birthday-cake"></i></div>
            <div class="stat-info">
                <div class="value count-up" data-target="{{ dados.media_idades }}">0.0</div>
                <div class="label">Média de Idade dos Alunos</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon hours"><i class="fas fa-clock"></i></div>
            <div class="stat-info">
                <div class="value count-up" data-target="{{ dados.media_horas }}">0.0</div>
                <div class="label">Média de Horas de Estudo Diárias</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon courses"><i class="fas fa-book-open"></i></div>
            <div class="stat-info">
                <div class="value">{{ dados.total_cursos }}</div>
                <div class="label">Total de Cursos Disponíveis</div>
            </div>
        </div>
    </div>

    <hr style="border: 0; border-top: 1px solid var(--border-color); margin: 30px 0;">
    
    <div class="row" style="display: flex; gap: 20px;">
        <div class="col-md-6" style="flex: 1;">
            <h3 style="border-bottom: 1px solid var(--border-color); padding-bottom: 10px;">Alunos por Curso</h3>
            <ul class="list-group">
                {% for curso, count in dados.alunos_por_curso.items() %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {{ curso }}
                    <span class="badge badge-primary badge-pill">{{ count }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>
        <div class="col-md-6" style="flex: 1;">
            <h3 style="border-bottom: 1px solid var(--border-color); padding-bottom: 10px;">Distribuição de Idade</h3>
            <ul class="list-group">
                {% for faixa, count in dados.faixas_idade.items() %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {{ faixa }} anos
                    <span class="badge badge-primary badge-pill">{{ count }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% else %}
    <p class="no-data">Não há dados suficientes para gerar um relatório.</p>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const counters = document.querySelectorAll('.count-up');
    const speed = 200; // A velocidade da animação

    counters.forEach(counter => {
        const animate = () => {
            const target = +counter.getAttribute('data-target');
            const count = +counter.innerText;

            // Define o incremento. Se for decimal, usa um incremento menor
            const isDecimal = target % 1 !== 0;
            const increment = isDecimal ? target / (speed * 2) : Math.ceil(target / speed);

            if (count < target) {
                const newCount = count + increment;
                // Formata para uma casa decimal se o alvo for decimal
                counter.innerText = isDecimal ? Math.min(newCount, target).toFixed(1) : Math.ceil(Math.min(newCount, target));
                setTimeout(animate, 10);
            } else {
                counter.innerText = isDecimal ? target.toFixed(1) : target;
            }
        };
        animate();
    });
});
</script>
{% endblock %}